pipelines:
  liget:
    group: stcdev
    label_template: "${git[:8]}"
    materials:
      git:
        type: configrepo
    stages:
      - build:
          clean_workspace: true
          jobs:
            build:
              elastic_profile_id: w.c2.m2048.e10
              artifacts:
                - build:
                    source: src/LiGet.App/bin/Release/netcoreapp2.0/publish/**/*
                    destination: src/LiGet.App/bin/Release/netcoreapp2.0/publish
                - build:
                    source: tests/LiGet.Tests/bin/Release/netcoreapp2.0/publish/**/*
                    destination: tests/LiGet.Tests/bin/Release/netcoreapp2.0/publish
              tasks:
               - exec:
                  command: ide
                  arguments:
                    - "./tasks.sh build"
      - test:
          clean_workspace: true
          jobs:
            unit:
              elastic_profile_id: w.c2.m2048.e10
              tasks:
               - fetch:
                  stage: build
                  job: build
                  source: tests
                  destination:
               - exec:
                  command: ide
                  arguments:
                    - "./tasks.sh test"
            itest:
              elastic_profile_id: w.c2.m2048.e10
              tasks:
               - fetch:
                  stage: build
                  job: build
                  source: src
                  destination:
               - exec:
                  command: /bin/bash
                  arguments:
                    - -c
                    - "./tasks.sh itest"
